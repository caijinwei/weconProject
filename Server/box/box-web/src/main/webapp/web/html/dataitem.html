
<!DOCTYPE html>
<html lang="en" ng-app="weconweb">
<head>
<meta charset="UTF-8">
<title>Title</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!--<script src="http://apps.bdimg.com/libs/jquery/2.0.0/jquery.min.js"></script>-->
<link rel="stylesheet" type="text/css" href="../css/style.css" />
<link rel="stylesheet"
	href="../lib/bootstrap/3.3.7/css/bootstrap.min.css">
<script src="../lib/jquery/jquery-3.2.1.min.js"></script>
<script src="../lib/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<link rel="stylesheet"
	href="../lib/font-awesome/4.7.0/css/font-awesome.min.css">
<link href="../css/page.css" rel="stylesheet" type="text/css" />

</head>
<body ng-controller="infoController" ng-init="onInit()">
	<div class="conatiner-fluid">
		<table class="table table-bordered" style="margin-top: 20px;">
			<!-- <caption>
            <button type="button" class="btn btn-primary" data-toggle="modal"  data-target="#addpoint">
                <span class="glyphicon glyphicon-plus"></span> 添加监控点
            </button>
            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#addpoint">
                <span class="glyphicon glyphicon-list" style="margin-left: 15px;"></span> 批量添加
            </button>
        </caption> -->
			<thead>
				<tr>
					<th class="col-md-1">ID</th>
					<th class="col-md-1">状态</th>
					<th class="col-md-1">名称</th>
					<th class="col-md-1">数值</th>
					<th class="col-md-2">地址</th>
					<th class="col-md-2">地址类型</th>
					<th class="col-md-2">描述</th>
					<th class="col-md-2">操作</th>
				</tr>
			</thead>
			<tbody>
				<tr ng-repeat="x in actDatas">
					<td>{{x.id}}</td>
					<td>{{x.re_state==0?"超时":"在线"}}</td>
					<td>{{x.name}}</td>
					<td>{{x.re_value}}</td>
					<td>{{x.addr}}</td>
					<td>{{x.addr_type==0?"位地址":x.addr_type==1?"字地址":"双字"}}</td>
					<td>{{x.describe}}</td>
					<td><a href="#" title="编辑"> <span
							class="glyphicon glyphicon-edit" data-toggle="modal"
							data-target="#editGroupName"></span>
					</a> <a href="#" title="复制"> <span class="glyphicon glyphicon-file"
							data-toggle="modal" data-target="#sd"></span>
					</a> <a href="#" title="移除"> <span
							class="glyphicon glyphicon-trash" data-toggle="modal"
							data-target="#deleteGroup"></span>
					</a> <a href="#" title="移动分组"> <span
							class="glyphicon glyphicon-resize-horizontal" data-toggle="modal"
							data-target="#movegroup"></span>
					</a></td>
				</tr>

			</tbody>
		</table>
		<tm-pagination conf="paginationConf"></tm-pagination>
		<!--添加监控点-->
		<div class="modal" id="addpoint" tabindex="-1" data-backdrop="false">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal">
							<span>&times;</span>
						</button>
						<h4 class="modal-title">添加监控数据</h4>
					</div>
					<div class="modal-body">
						<div class="container-fluid">
							<div class="row col-md-11 col-md-offset-1"
								style="margin: 10px 0;">
								<span class="col-md-3">名称</span><input type="text"
									class="col-md-9" style="height: 30px; padding-left: 5px;" />
							</div>
							<div class="row col-md-11 col-md-offset-1"
								style="margin: 10px 0;">
								<span class="col-md-3">连接设备</span> <select class="col-md-9"
									style="height: 30px;">
									<option>SIMUTOCOL LX1S</option>
									<option>SIMUTOCOL LX2N</option>
									<option>SIMUTOCOL LX3V</option>
								</select>
							</div>
							<div class="row col-md-11 col-md-offset-1"
								style="margin: 10px 0;">
								<span class="col-md-3">数据格式</span> <select id="datatype"
									class="col-md-9" style="height: 30px;"
									onchange="show_sub(this.options[this.options.selectedIndex].value)">
									<option value="0">0：位地址</option>
									<option value="162">16位二进制</option>
									<option value="168">16位八进制</option>
									<option value="1616">16位十六进制</option>
									<option value="16bcd">16位BCD码</option>
									<option value="16110">16位有符号十进制数</option>
									<option value="16010">16位无符号十进制数</option>
									<option value="322">32位二进制</option>
									<option value="328">32位八进制</option>
									<option value="3216">32位十六进制</option>
									<option value="32bcd">32位BCD码</option>
									<option value="32110">32位有符号十进制数</option>
									<option value="32010">32位无符号十进制数</option>
									<option value="32f">32位（单精度）浮点数</option>
									<option value="64d">64位（双精度）浮点数</option>
								</select>
							</div>
							<div class="row col-md-11 col-md-offset-1"
								style="margin: 10px 0;">
								<span class="col-md-3">地址</span><input type="text"
									class="col-md-6" style="height: 30px; padding-left: 5px;" />
								<button type="button"
									class="btn btn-info col-md-2 col-md-offset-1"
									data-toggle="modal" data-target="#addrsetting">设置</button>
							</div>

							<div id="datadigits" class="row col-md-11 col-md-offset-1"
								style="margin: 10px 0; display: none;">
								<div id="div-integer">
									<span class="col-md-3">整数位数</span> <select id="integerdigits"
										class="col-md-3" style="height: 30px;" onchange="getData()">

									</select>
								</div>
								<div id="div-decimal">
									<span class="col-md-3">小数位数</span> <select id="decimaldigits"
										class="col-md-3" style="height: 30px;"
										onchange="calcuSystem()">

									</select>
								</div>
							</div>
							<div class="row col-md-11 col-md-offset-1"
								style="margin: 10px 0;">
								<div id="value-min">
									<span class="col-md-3">最小值</span> <input id="dataMin"
										type="number" class="col-md-3"
										style="height: 30px; padding-left: 5px;" value="0" min="" />
								</div>
								<div id="value-max">
									<span class="col-md-3">最大值</span> <input id="dataMax"
										type="number" class="col-md-3"
										style="height: 30px; padding-left: 5px;" value="1" />
								</div>
							</div>
							<div class="row col-md-11 col-md-offset-1"
								style="margin: 10px 0;">
								<span class="col-md-3">历史数据采集周期（天）</span> <input type="text"
									class="col-md-9" style="height: 30px; padding-left: 5px;"
									value="2" />
							</div>
							<div class="row col-md-11 col-md-offset-1"
								style="margin: 10px 0;">
								<span class="col-md-3">描述</span> <input type="text"
									class="col-md-9" style="height: 30px; padding-left: 5px;"
									placeholder="0X 1" />
							</div>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-info">确定</button>
						<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
					</div>
				</div>

			</div>
		</div>
		<!--添加监控点-->
		<div class="modal" id="movegroup" tabindex="-1" data-backdrop="false">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal">
							<span>&times;</span>
						</button>
						<h4 class="modal-title">移动分组</h4>
					</div>
					<div class="modal-body">
						<div class="container-fluid">
							<div class="row col-md-11 col-md-offset-1"
								style="margin: 10px 0;">
								<span class="col-md-3">当前分组</span> <span class="col-md-9">数据分组1</span>
							</div>
							<div class="row col-md-11 col-md-offset-1"
								style="margin: 10px 0;">
								<span class="col-md-3">移动到</span> <select id="groupselect"
									class="col-md-9" style="height: 30px;"
									onchange="show_sub(this.options[this.options.selectedIndex].value)">
									<option>数据分组1</option>
									<option>数据分组2</option>
									<option>数据分组3</option>
								</select>
							</div>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-info">确定</button>
						<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
					</div>
				</div>

			</div>
		</div>
	</div>
	</div>


	<!--设置地址-->
	<div class="modal" id="addrsetting" tabindex="1" data-backdrop="false">
		<div class="modal-dialog modal-sm">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal">
						<span>&times;</span>
					</button>
					<h4 class="modal-title">设置地址</h4>
				</div>
				<div class="modal-body">
					<div class="container-fluid">
						<div style="margin: 10px 0;">
							<div class="row">
								<span class="col-md-5">寄存器类型</span> <select class="col-md-7"
									style="height: 30px;">
									<option value="x">X</option>
									<option value="y">Y</option>
									<option value="m">M</option>
									<option value="t">T</option>
									<option value="c">C</option>
									<option value="d">D</option>
									<option value="s">S</option>
									<option value="sd">SD</option>
									<option value="ch">CH</option>
								</select>
							</div>
							<div class="row" style="margin-top: 20px;">
								<span class="col-md-5">寄存器地址</span> <input type="text"
									class="col-md-7" style="height: 30px; padding-left: 5px;"
									placeholder="十进制数或十六进制数" />
							</div>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-info">确定</button>
						<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
					</div>
				</div>

			</div>
		</div>
	</div>
	<script type="text/javascript">
		//数据格式变化时，影响到整数位和小数位的菜单项数目
		function show_sub(v) {

			$("#integerdigits").empty();
			$("#decimaldigits").empty();
			if (v == '0') {
				$('#datadigits').css('display', 'none');
			} else {
				$('#datadigits').css('display', 'block');
			}
			if (v == '162' || v == '168' || v == '1616' || v == '322'
					|| v == '328' || v == '3216') {
				$('#decimaldigits').attr('disabled', 'disabled');
				$('#decimaldigits').css('cursor', 'not-allowed')

			} else {
				$('#decimaldigits').removeAttr('disabled');
				$('#decimaldigits').css('cursor', 'auto')
			}
			switch (v) {
			case '162':
				setOption(16);
				setMaxAndMin(0x0, 0x1ff);
				break;
			case '168':
				setOption(6);
				setMaxAndMin(0x0, 0x1ff);
				break;
			case '1616':
				setOption(4);
				setMaxAndMin(0x0, 0x1ff);
				break;
			case '16bcd':
				setDecimaldigitsOption(0);
				setOption(4);
				break;
			case '16110':
				setDecimaldigitsOption(1);
				setOption(5);
				break;
			case '16010':
				setDecimaldigitsOption(1);
				setOption(5);
				break;
			case '322':
				setOption(32);
				break;
			case '328':
				setOption(11);
				break;
			case '3216':
				setOption(8);
				break;
			case '32bcd':
				setDecimaldigitsOption(4);
				setOption(8);
				break;
			case '32110':
				setDecimaldigitsOption(6);
				setOption(10);
				break;
			case '32010':
				setDecimaldigitsOption(6);
				setOption(10);
				break;
			case '32f':
				setDecimaldigitsOption(3);
				setOption(7);
				break;
			default:
				setDecimaldigitsOption(11);
				setOption(15);
				break;
			}
		}
		function setMaxAndMin(max, min) {
			$('#dataMin').attr('min', min);
			$('#dataMax').attr('max', max);
		}

		/**
		 * 初始化整数位菜单项
		 * （初始化，指的是当数据格式变化时，
		 *  首次确定整数位和小数位菜单项数目，
		 *  当整数位菜单项的选择变化时，
		 *  小数位的菜单项数目还会随着变化）
		 * @param index
		 */
		function setOption(index) {
			//        alert("有执行到for循环,index值是："+index);
			for (var i = 1; i <= index; i++) {
				$("#integerdigits").append(
						"<option value='"+i+"'>" + i + "</option>");
			}
		}

		/**
		 * 初始化小数位菜单项
		 * @param index
		 */
		function setDecimaldigitsOption(index) {
			for (var i = 0; i <= index; i++) {
				$("#decimaldigits").append(
						"<option value='"+i+"'>" + i + "</option>");
			}
		}

		/**
		 * 监听整数位菜单项的选择的变化，改变小数位的菜单项数目
		 * @param total
		 */
		function setDecimalRelOption(total) {
			alert("当前总位数是：" + total);
			//先清空小数位下拉菜单项
			$("#decimaldigits").empty();
			//得到整数位下拉菜单项数
			var integerNum = $('#integerdigits').val();
			//        $('#').options[this.options.selectedIndex].value
			alert(integerNum);
			//得到小数位下拉菜单项数
			var decimalNum = total - integerNum;
			alert("整数位数是：" + integerNum + ",小数位数是：" + decimalNum);
			//生成菜单项
			for (var i = 0; i <= decimalNum; i++) {
				$("#decimaldigits").append(
						"<option value='"+i+"'>" + i + "</option>");
			}
		}

		//    (0[xX])?([0-9a-fA-F]+) 正则表达式匹配十六进制数
		//    var str;
		//    var regexp = new RegExp("");
		//    var isLegal = regexp.test(str);
	</script>

</body>
<script src="../lib/jquery/jquery-3.2.1.min.js" type="text/javascript"></script>
<script src="../lib/bootstrap/3.3.7/js/bootstrap.min.js"
	type="text/javascript"></script>
<script src="../lib/angular/angular.min.js" type="text/javascript"></script>
<script src="../lib/wecon-common.js" type="text/javascript"></script>
<script src="../js/dataitem.js" type="text/javascript"></script>
<script src="../lib/pagination.js" type="text/javascript"></script>
</html>